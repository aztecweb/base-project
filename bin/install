#!/bin/sh
#
# Install and configure the website in the public directory

WP_CLI='vendor/bin/wp --allow-root'

if [ ! -f .env ]; then
    echo 'Dotenv file not found'
    exit 1
fi

if [ -z ${DEPLOY_STAGE} ]; then
	DEPLOY_STAGE='development'
fi

echo "Installing project in ${DEPLOY_STAGE}"

# Copy the config file before start installation
cp config/wp-config/${DEPLOY_STAGE}.php public/wp-config.php

# Copy wp-cli config file
cp config/wp-cli/${DEPLOY_STAGE}.yml wp-cli.yml 

# Remove default WordPress packages 
rm -rf public/wp-content/themes/twenty*
rm -rf public/wp-content/plugins/{akismet,hello.php}
rm -rf public/wp-content/languages/{plugins,themes}

# Generate env salts file
if [ ! -f .salts ]; then
    $WP_CLI dotenv salts generate --file='.salts'
fi

# Install the WordPress
$WP_CLI core install

# Update language of core, theme and plugins
$WP_CLI core language update
